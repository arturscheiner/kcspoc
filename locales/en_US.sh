#!/bin/bash
# Locale: en_US (English - United States)

# --- General ---
MSG_USAGE="Usage"
MSG_COMMANDS="Commands"
MSG_CMD_CONFIG_DESC="Run interactive configuration wizard"
MSG_CMD_PULL_DESC="Download KCS chart (usage: pull [--version X.X.X])"
MSG_CMD_CHECK_DESC="Verify environment and prerequisites"
MSG_CMD_PREPARE_DESC="Run the installation preparation (requires config)"
MSG_CMD_DEPLOY_DESC="Launch the KCS deployment process"
MSG_CMD_HELP_DESC="Show this help message"
MSG_VERSION="Version"
MSG_AUTHOR="Author"
MSG_ERROR_CONFIG_NOT_FOUND="Error: Configuration not found. Please run 'kcspoc config' first."

# --- Helper UI ---
MSG_DEFAULT="Default"

# --- Config Command ---
MSG_CONFIG_WIZARD_TITLE="Configuration Wizard"
MSG_CONFIG_WIZARD_DESC="This wizard generates the ~/.kcspoc/config file."
MSG_CONFIG_LOADED="Loaded existing configuration."
MSG_CONFIG_SAVED="Configuration saved to"
MSG_CONFIG_VER_UPDATED="KCS version pinned to"
MSG_CONFIG_NEXT_STEPS="Next steps: run 'kcspoc check' to verify your environment."

MSG_STEP_LANG="Preferred Language"
MSG_STEP_LANG_DESC="Select the interface language."
MSG_INPUT_LANG="Language (en_US, pt_BR, etc)"
MSG_LANG_AVAILABLE="Available"

MSG_STEP_NS="Kubernetes Namespace"
MSG_STEP_NS_DESC="Where KCS resources will be created."
MSG_INPUT_NS="Namespace"

MSG_STEP_DOMAIN="Base Domain"
MSG_STEP_DOMAIN_DESC="Domain for KCS console/services (e.g. kcs.lab)."
MSG_INPUT_DOMAIN="Domain"

MSG_STEP_REG="Registry Credentials"
MSG_STEP_REG_DESC="Access to KCS container images."
MSG_INPUT_REG_URL="Server URL"
MSG_INPUT_REG_USER="Username"
MSG_INPUT_REG_PASS="Password"
MSG_INPUT_REG_EMAIL="Email"

MSG_STEP_METALLB="MetalLB IP Range"
MSG_STEP_METALLB_DESC="Range for LoadBalancer (e.g. 172.16.0.10-172.16.0.20)"
MSG_INPUT_IP_RANGE="IP Range"

MSG_STEP_DEEP="Deep Node Inspection"
MSG_STEP_DEEP_DESC="Run privileged pods to check disk/headers?"
MSG_INPUT_DEEP="Enable Deep Check? (true/false)"

MSG_STEP_VERSION="KCS Version"
MSG_STEP_VERSION_DESC="Target version to deploy."
MSG_STEP_SECRETS="Secrets and Credentials"
MSG_STEP_SECRETS_DESC="Configure passwords for databases and internal services."
MSG_STEP_PLATFORM="Target Platform"
MSG_STEP_PLATFORM_DESC="Select the Kubernetes distribution where KCS will be deployed."
MSG_STEP_CRI="CRI Socket Path"
MSG_STEP_CRI_DESC="Specify the container runtime socket (e.g., /run/containerd/containerd.sock)."
MSG_INPUT_VERSION="Version"
MSG_INPUT_PLATFORM="Platform (kubernetes/openshift)"
MSG_INPUT_CRI_SOCKET="Socket Path (Leave blank to auto-detect)"
MSG_INPUT_SECRETS_AUTO="Auto-generate all secrets randomly? [y/N]"
MSG_INPUT_PG_USER="PostgreSQL Username"
MSG_INPUT_PG_PASS="PostgreSQL Password"
MSG_INPUT_MINIO_USER="Minio Root Username"
MSG_INPUT_MINIO_PASS="Minio Root Password"
MSG_INPUT_CH_ADMIN_PASS="Clickhouse Admin Password"
MSG_INPUT_CH_WRITE_PASS="Clickhouse Write Password"
MSG_INPUT_CH_READ_PASS="Clickhouse Read Password"
MSG_INPUT_MCHD_USER="MCHD Username"
MSG_INPUT_MCHD_PASS="MCHD Password"
MSG_INPUT_APP_SECRET="Application Secret (APP_SECRET)"

# --- Pull Command ---
MSG_PULL_TITLE="Pulling KCS Chart"
MSG_PULL_AUTH="Authenticating to Registry"
MSG_PULL_LOGIN_OK="Login Successful"
MSG_PULL_LOGIN_FAIL="Login Failed"
MSG_PULL_LOGIN_ERR="Error: Could not login to registry."
MSG_PULL_VER_SRC_FLAG="Version Source: Command Flag"
MSG_PULL_VER_SRC_CONFIG="Version Source: Config File"
MSG_PULL_VER_SRC_DEFAULT="Version Source: Default (latest)"
MSG_PULL_DOWNLOADING="Downloading KCS Chart..."
MSG_PULL_SUCCESS="Download successful."
MSG_PULL_ERR_FILE="Error: Downloaded file not found!"
MSG_PULL_ERR_FAIL="Helm pull failed."
MSG_PULL_LOCAL_TITLE="Locally Available KCS Versions"
MSG_PULL_LOCAL_EMPTY="No local artifacts found."
MSG_PULL_TABLE_ACTIVE="Active"
MSG_PULL_TABLE_VER="Version"
MSG_PULL_TABLE_DATE="Downloaded"
MSG_PULL_TABLE_PATH="Path"
MSG_PULL_ACTIVE_MARKER="*"

# --- Check Command ---
MSG_CHECK_TITLE="Environment Check"
MSG_CHECK_TOOLS="Checking CLI tools..."
MSG_CHECK_TOOLS_FAIL="Missing required tools"
MSG_CHECK_CONFIG="Checking Configuration..."
MSG_CHECK_CONFIG_FAIL="FAIL (Missing variables in config)"
MSG_CHECK_CONFIG_FIX="Run 'kcspoc config' to fix this."
MSG_CHECK_CONFIG_CREATE="Run 'kcspoc config' to create it."
MSG_CHECK_KUBECONFIG="Checking Kubeconfig existence..."
MSG_CHECK_KUBECONFIG_FAIL="Kubeconfig not found at ~/.kube/config"
MSG_CHECK_CONN_FAIL="Could not connect to Kubernetes cluster"
MSG_CHECK_CONN_ERR="Connectivity Error"
MSG_CHECK_RESOURCES_TITLE="=== Cluster Resources & Topology ==="
MSG_CHECK_K8S_VER="Checking Kubernetes Version..."
MSG_CHECK_PASS="Pass"
MSG_CHECK_FAIL="FAIL"
MSG_CHECK_ARCH="Checking Architecture..."
MSG_CHECK_ARCH_MIXED="Mixed Architectures detected"
MSG_CHECK_ARCH_WARN="Warning: Core only supports amd64"
MSG_CHECK_ARCH_NONE="No amd64 nodes found"
MSG_CHECK_RUNTIME="Checking Container Runtime..."
MSG_CHECK_RUNTIME_WARN="Warning: Deprecated"
MSG_CHECK_CNI="Checking CNI Plugin..."
MSG_CHECK_CNI_DETECTED="Detected"
MSG_CHECK_CNI_WARN="Warning: No common CNI pods detected."
MSG_CHECK_NODE_RES_TITLE="Node Resources (CPU / RAM / Disk / Kernel Headers / eBPF):"
MSG_CHECK_DEEP_RUN="Running Deep Node Inspection (Privileged Pods)..."
MSG_CHECK_DEEP_SKIP="(Deep Check Disabled: Basic info only)"
MSG_CHECK_REPO_CONN="Checking Repo Connectivity"
MSG_CHECK_GLOBAL_TOTALS="Global Cluster Totals"
MSG_CHECK_ALL_PASS="All checks passed."
MSG_CHECK_ALL_PASS="All checks passed."
MSG_CHECK_FINAL_FAIL="Checks failed. Please address the issues above."

MSG_CHECK_CLOUD_TITLE="Cloud Provider & Topology"
MSG_CHECK_CLOUD_PROVIDER="Provider"
MSG_CHECK_CLOUD_REGION="Region"
MSG_CHECK_CLOUD_ZONE="Zone"
MSG_CHECK_CLOUD_OS="OS Image"
MSG_CHECK_CLOUD_UNKNOWN="Unknown / Bare Metal"

# Infrastructure Dependencies
MSG_CHECK_INFRA_TITLE="Infrastructure Dependencies"
MSG_CHECK_INFRA_DESC="Verifying if required PoC components are present."
MSG_CHECK_INFRA_INSTALLED="Installed"
MSG_CHECK_INFRA_MISSING="Missing"

# Status Markers
MSG_CHECK_LABEL_PASS="[ PASS ]"
MSG_CHECK_LABEL_FAIL="[ FAIL ]"
MSG_CHECK_LABEL_WARN="[ WARN ]"
MSG_CHECK_LABEL_WARN="[ WARN ]"
MSG_CHECK_LABEL_INFO="[ INFO ]"

# Audit Checks
MSG_AUDIT_TITLE="Resource Compliance Audit"
MSG_AUDIT_REF_TABLE="Reference Table (Per Node)"
MSG_AUDIT_RES="Resource"
MSG_AUDIT_MIN="Min POC"
MSG_AUDIT_IDEAL="Ideal (High Perf)"
MSG_AUDIT_CPU="CPU (vCPUs)"
MSG_AUDIT_RAM="Memory RAM"
MSG_AUDIT_DISK="Disk (Ephemeral)"
MSG_AUDIT_NODE_EVAL="Node Evaluation"
MSG_AUDIT_FAIL_CPU="Insufficient CPU: Has %s vCPU(s), needed %s."
MSG_AUDIT_FAIL_RAM="Insufficient RAM: Has %s MiB, needed %s MiB."
MSG_AUDIT_FAIL_DISK="Insufficient Disk: Has %s GiB, needed %s GiB."
MSG_AUDIT_CAUSE_CPU="Cause: Critical slowness and partial scan failures."
MSG_AUDIT_CAUSE_RAM="Cause: Risk of OOMKill (Out of Memory) in DBs."
MSG_AUDIT_CAUSE_DISK="Cause: Vulnerability databases won't unpack (Scanner Offline)."
MSG_AUDIT_APPROVED="[ STATUS: APPROVED ]"
MSG_AUDIT_REJECTED="[ STATUS: REJECTED ]"
MSG_AUDIT_SUCCESS="SUCCESS: Environment compliant with POC requirements."
MSG_AUDIT_FAIL="FAIL: Environment does not meet minimum requirements."
MSG_AUDIT_REC="Recommendation: Adjust VM resources before installation."

# --- Prepare Command ---
MSG_PREPARE_START="Starting Preparation..."
MSG_PREPARE_USING_NS="Using Namespace"
MSG_PREPARE_USING_REG="Using Registry"
MSG_PREPARE_USING_DOMAIN="Using Domain"
MSG_PREPARE_USING_IP="Using IP Range"
MSG_PREPARE_STEP_1="Configuring Namespace and Registry Auth..."
MSG_PREPARE_STEP_1_A="Configuring Namespace..."
MSG_PREPARE_STEP_1_B="Configuring Registry Auth..."
MSG_PREPARE_CREATING_SECRET="Creating registry secret..."
MSG_PREPARE_STEP_2="Installing Infrastructure Dependencies..."
MSG_PREPARE_INSTALL_CERT="Installing Cert-Manager..."
MSG_PREPARE_INSTALL_LOCAL="Installing Local Path Provisioner..."
MSG_PREPARE_INSTALL_METRICS="Installing Metrics Server..."
MSG_PREPARE_STEP_3="Configuring MetalLB..."
MSG_PREPARE_STEP_4="Installing Ingress-Nginx..."
MSG_PREPARE_STEP_5="Installing Kernel Headers..."
MSG_PREPARE_SUDO_FAIL="sudo not found, skipping kernel headers install."
MSG_PREPARE_STEP_6="Final Verification..."
MSG_PREPARE_COMPLETED="Setup Completed!"
MSG_PREPARE_INGRESS_IP="Ingress IP"
MSG_PREPARE_HOSTS_HINT="Add this to your /etc/hosts"
MSG_PREPARE_LABEL_INFO="Resources will be tagged with label"
MSG_PREPARE_CHECKLIST="Installation Checklist"
MSG_PREPARE_UNATTENDED_RUN="Running in Unattended Mode..."
MSG_PREPARE_INTERACTIVE_WARN="The tool will install several infrastructure components. You will be asked for confirmation for each one."

MSG_PREPARE_PROMPT_INSTALL="Install %s? [y/N] "

MSG_PREPARE_WHY_CERT_TITLE="Why Cert-Manager?"
MSG_PREPARE_WHY_CERT_DESC="KCS requires HTTPS for the Admission Controller. Cert-Manager automates certificates for internal mTLS and the Web Console."

MSG_PREPARE_WHY_STORAGE_TITLE="Why Local Path Storage?"
MSG_PREPARE_WHY_STORAGE_DESC="KCS databases (Postgres/Clickhouse) need persistent storage. This provisioner creates volumes using the nodes' local disks."

MSG_PREPARE_WHY_METRICS_TITLE="Why Metrics Server?"
MSG_PREPARE_WHY_METRICS_DESC="Provides CPU/RAM usage data to the Kubernetes API. The KCS dashboard uses this to display container and node health."

MSG_PREPARE_WHY_METALLB_TITLE="Why MetalLB?"
MSG_PREPARE_WHY_METALLB_DESC="In On-Premise environments, Kubernetes doesn't provide external IPs. MetalLB assigns a real IP to the KCS Console."

MSG_PREPARE_WHY_INGRESS_TITLE="Why Ingress-Nginx?"
MSG_PREPARE_WHY_INGRESS_DESC="Acts as the gateway. It receives HTTPS connections and routes them to the KCS internal services."

MSG_PREPARE_WHY_HEADERS_TITLE="Why Kernel Headers?"
MSG_PREPARE_WHY_HEADERS_DESC="KCS Runtime Security (eBPF) needs headers to compile/load modules on the host system."

# --- Destroy Command ---
MSG_DESTROY_TITLE="KCS Removal (Deep Clean)"
MSG_DESTROY_WARN_TITLE="WARNING: DESTRUCTIVE OPERATION"
MSG_DESTROY_WARN_DESC="This will completely remove Kaspersky Container Security, including databases and logs."
MSG_DESTROY_CONFIRM_PHRASE="i want to remove kcs from my cluster %s"
MSG_DESTROY_PROMPT="Please type the phrase above to confirm:"
MSG_DESTROY_CANCEL="Operation cancelled. Confirmation phrase mismatch."
MSG_DESTROY_START="Starting KCS Removal..."
MSG_DESTROY_STEP_1="Removing Helm Release..."
MSG_DESTROY_STEP_2="Removing Namespace..."
MSG_DESTROY_STEP_3="Cleaning Residual PVCs..."
MSG_DESTROY_STEP_4="Cleaning Orphaned PVs..."
MSG_DESTROY_STEP_5="Removing Global Webhooks..."
MSG_DESTROY_STEP_6="Removing Global RBAC (ClusterRoles/Bindings)..."
MSG_DESTROY_DEPS_PROMPT="Do you also want to remove INFRASTRUCTURE DEPENDENCIES (MetalLB, Ingress, Cert-Manager)? [y/N]"
MSG_DESTROY_DEPS_TITLE="Removing Infrastructure Dependencies..."
MSG_DESTROY_DEPS_INGRESS="Removing Ingress-Nginx..."
MSG_DESTROY_DEPS_METALLB="Removing MetalLB..."
MSG_DESTROY_DEPS_CERT="Removing Cert-Manager..."
MSG_DESTROY_DEPS_STORAGE="Removing Storage Class & Metrics..."
MSG_DESTROY_DEPS_SKIPPED="Infrastructure dependencies preserved as requested."
MSG_DESTROY_REMOVED="Removed"
MSG_DESTROY_NOT_FOUND="Not Found (Skipped)"
MSG_DESTROY_SUCCESS="KCS has been completely removed from the cluster."
MSG_DESTROY_HINT="Dependencies (MetalLB, Cert-Manager) were preserved."

# --- Deploy Command ---
MSG_DEPLOY_TITLE="Deployment of Kaspersky Container Security"
MSG_DEPLOY_CORE="KCS Core"
MSG_DEPLOY_AGENTS="KCS Agents"
MSG_DEPLOY_HEALTH_CHECK="Post-Deployment Health Check"
MSG_DEPLOY_PVC_STATUS="Verifying Storage (PVCs)"
MSG_DEPLOY_LABEL_CHECK="Verifying Labels"
MSG_DEPLOY_POD_STATUS="Verifying Pod Lifecycle"
MSG_DEPLOY_BOOTSTRAP_PODS="Waiting for core pods to settle..."
MSG_CHECK_CRI_DETECTING="Detecting Container Runtime (CRI)..."
MSG_CHECK_CRI_FOUND="Detected Runtime:"
MSG_CHECK_CRI_SOCKET="Suggested Socket:"
MSG_CHECK_CRI_CONFIRMED="Confirmed via Deep Inspect:"
MSG_CHECK_CRI_HINT="Tip: You can set this in 'kcspoc config' or it will be injected automatically."
MSG_DEPLOY_BOOTSTRAP_OK="Core deployment accepted. Bootstrap in progress..."
MSG_DEPLOY_SUCCESS="KCS deployment initiated successfully."
MSG_DEPLOY_BOOTSTRAP_HINT="To watch the real-time progress, run:"
MSG_DEPLOY_VALIDATING="Validating deployment configuration..."
MSG_DEPLOY_ERR_MISSING_PLACEHOLDERS="Deployment aborted! The following placeholders were not fulfilled in the template:"
MSG_DEPLOY_ERR_HINT="Run './kcspoc config' to complete your setup."
MSG_DEPLOY_CONFIRM="KCS is not detected in the cluster. Do you want to proceed with the core installation of version"
MSG_DEPLOY_EXISTING="KCS version %s is already installed in namespace %s."
MSG_DEPLOY_UPGRADE_PROMPT="Do you want to proceed with the update/install of version %s?"
MSG_DEPLOY_ERR_NO_ARTIFACTS="Error: No KCS versions found in local cache. Please run './kcspoc pull' first."
MSG_DEPLOY_TEMPLATE_CHECK="Checking for remote template updates..."
MSG_DEPLOY_TEMPLATE_UPDATED="A newer version of the template is available online."
MSG_DEPLOY_TEMPLATE_PROMPT="Do you want to backup the current one and download the new version? [y/N]"
MSG_DEPLOY_TEMPLATE_BACKUP="Backup created:"
MSG_DEPLOY_TEMPLATE_DOWNLOAD_OK="Template updated successfully."

# --- Help System ---
MSG_HELP_DESCRIPTION="Description"
MSG_HELP_OPTIONS="Options"
MSG_HELP_EXAMPLES="Examples"

# Config Help
MSG_HELP_CONFIG_DESC="Starts the interactive configuration wizard to setup or update your ~/.kcspoc/config environment variables."
MSG_HELP_CONFIG_OPTS="--set-version <ver>|Quickly update the active KCS version without entering the wizard."
MSG_HELP_CONFIG_EX="kcspoc config\nkcspoc config --set-version 2.3.0"

# Pull Help
MSG_HELP_PULL_DESC="Downloads the Kaspersky Container Security Helm chart from the official registry. Authenticates using your config credentials."
MSG_HELP_PULL_OPTS="--version <ver>|Specifically target a chart version (e.g., 2.3.0)\n--list-local|List all chart versions already pulled and available locally."
MSG_HELP_PULL_EX="kcspoc pull\nkcspoc pull --version 2.2.0"

# Check Help
MSG_HELP_CHECK_DESC="Performs a comprehensive diagnostic of your Kubernetes cluster, including tool checks, connectivity, and resource compliance auditing."
MSG_HELP_CHECK_OPTS="--deep|Enable privileged pods to check kernel headers and eBPF readiness."
MSG_HELP_CHECK_EX="kcspoc check\nkcspoc check --deep"

# Prepare Help
MSG_HELP_PREPARE_DESC="Orchestrates the installation of infrastructure dependencies (MetalLB, Nginx, Cert-Manager) and local storage to prepare for KCS."
MSG_HELP_PREPARE_OPTS="--unattended|Install all components without asking for user confirmation."
MSG_HELP_PREPARE_EX="kcspoc prepare\nkcspoc prepare --unattended"

# Destroy Help
MSG_HELP_DESTROY_DESC="Safely uninstalls KCS and its associated resources from your cluster. Includes optional cleanup of infrastructure dependencies."
MSG_HELP_DESTROY_OPTS="--unattended|Bypass confirmation prompts (USE WITH CAUTION)."
MSG_HELP_DESTROY_EX="kcspoc destroy\nkcspoc destroy --unattended"

# Logs Help
MSG_HELP_LOGS_DESC="Manage the execution logs of the kcspoc tool. Allows viewing history and deep-diving into specific execution IDs."
MSG_HELP_LOGS_OPTS="--list [cmd]|Show last 10 logs (optionally filtered by command)\n--show <hash>|View the full debug output for a specific execution ID\n--cleanup|Delete all stored logs from ~/.kcspoc/logs"
MSG_HELP_LOGS_EX="kcspoc logs --list\nkcspoc logs --list prepare\nkcspoc logs --show A1B2C3\nkcspoc logs --cleanup"

# Deploy Help
MSG_HELP_DEPLOY_DESC="Deploys the Kaspersky Container Security components (Core and Agents) to your cluster."
MSG_HELP_DEPLOY_OPTS="--core|Deploy the main KCS management console and backend.\n--agents|Deploy the security agents to your nodes (Finalizing).\n--check [hash\|version]|Verify if local config/version matches the existing cluster installation.\n--values <file>|Provide a custom values.yaml file to override the default template."
MSG_HELP_DEPLOY_EX="kcspoc deploy --core\nkcspoc deploy --agents"
