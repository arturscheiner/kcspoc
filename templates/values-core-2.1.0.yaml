################################################################################
# KCS EDUCATIONAL TEMPLATE - Version 2.1.0
# ------------------------------------------------------------------------------
# üéØ TARGET AUDIENCE: Pre-Sales Engineers & Architects
# ‚ö†Ô∏è ENVIRONMENT: POC / LAB ONLY (Base version for lifecycle testing)
#
# üìù VERSION CHARACTERISTICS:
# 1. Base Version: This is our starting point for upgrade path simulations.
# 2. Identity Bootstrap: Unlike later versions, 2.1.0 is more permissive but 
#    still requires 'certSource: helm' to correctly trigger Cert-Manager.
# 3. Simple Policies: Network Policies in this version do not yet require 
#    the explicit 'ingressControllerNamespaces' list.
################################################################################

# --- [TEACHING POINT: METADATA & TRACEABILITY] ---
# In 2.1.0, 'commonLabels' helps us identify resources. 
# We use 'kcspoc.io' prefix to distinguish automated lab resources.
commonLabels:
  kcspoc.io/managed-by: "kcspoc"
  kcspoc.io/config-hash: "$PROVISION_HASH_CONFIG"
  kcspoc.io/tool-version: "$PROVISION_VERSION_CONFIG"
  kcspoc.io/kcs-version: "2.1.0"

default:
  platform: "$PLATFORM_CONFIGURED"
  domain: "$DOMAIN_CONFIGURED"
  
  # --- [TEACHING POINT: IDENTITY BOOTSTRAP] ---
  # In 2.1.0, setting 'certSource: helm' is the most reliable way to ensure 
  # that internal mTLS certificates are generated and managed by Cert-Manager.
  certSource: "helm"
  internalTLS:
    enabled: true
    certSource: "helm"
  certManager: true

  # --- [TEACHING POINT: UPDATES COMPONENT] ---
  # Essential for vulnerability database synchronization. 
  # Note: Ensure this is correctly aligned under 'default'.
  updates:
    enabled: true

  # --- [TEACHING POINT: NETWORK POLICIES] ---
  # Version 2.1.0 is less strict than 2.1.1+. 
  # We can enable it here, but explicit ingress namespaces are optional.
  networkPolicies:
    create: true

  # Lab Optimization: Image Handler (IH) consumes significant memory.
  # We force 1 replica for POCs to stay within small node limits.
  kcs-ih:
    replicaCount: 1

  postgresql:
    resources:
      requests: { cpu: "100m", memory: "512Mi" }
      limits: { cpu: "500m", memory: "1Gi" }

nodeAgent:
  enabled: true
  runtimeSocketPath: "$CRI_SOCKET_CONFIG"
  installStrategy: DaemonSet

admissionController:
  enabled: true
  replicaCount: 1

configmap:
  infraconfig:
    type: fromEnvs
    envs:
      TLS_INTERNAL: true
      # --- [TEACHING POINT: IMAGE TAGGING] ---
      # In this template, we hardcode the v2.1.0 tags to prevent accidental 
      # pull of newer images if the registry has 'latest' floating tags.
      KUBE_AGENT_TAG: v2.1.0
      NODE_AGENT_TAG: v2.1.0
      SCANNER_TAG: v2.1.0
      IMAGE_TAG_MIDDLEWARE: v2.1.0

issuer:
  create: true
  name: kcs-issuer
  kind: Issuer
  selfSigned: true

pullSecret:
  kcs-pullsecret:
    registry: "$REGISTRY_SERVER_CONFIG"
    username: "$REGISTRY_USER_CONFIG"
    password: "$REGISTRY_PASS_CONFIG"
    email: "$REGISTRY_EMAIL_CONFIG"

ingress:
  kcs:
    domain: "$DOMAIN_CONFIGURED"
    ingressClass: "nginx"

persistentVolume:
  postgresql: { size: 20Gi }
  pvc-minio: { size: 5Gi }
  pvc-clickhouse-cold: { size: 40Gi }
  pvc-clickhouse-hot: { size: 20Gi }

secret:
  infracreds:
    type: fromEnvs
    envs:
      POSTGRES_USER: "$POSTGRES_USER_CONFIG"
      POSTGRES_PASSWORD: "$POSTGRES_PASS_CONFIG"
      MINIO_ROOT_USER: "$MINIO_USER_CONFIG"
      MINIO_ROOT_PASSWORD: "$MINIO_PASS_CONFIG"
      CLICKHOUSE_ADMIN_PASSWORD: "$CH_ADMIN_PASS_CONFIG"
      CLICKHOUSE_WRITE_PASSWORD: "$CH_WRITE_PASS_CONFIG"
      CLICKHOUSE_READ_PASSWORD: "$CH_READ_PASS_CONFIG"
      MCHD_USER: "$MCHD_USER_CONFIG"
      MCHD_PASS: "$MCHD_PASS_CONFIG"
      # --- [TEACHING POINT: CRYPTOGRAPHY KEY] ---
      # This is the 'Root of Trust' for your data. 
      # MUST remain consistent across all 'update' or 'upgrade' operations.
      APP_SECRET: "$APP_SECRET_CONFIG"