# kcspoc v0.6.0 Execution-Level TODOs

This file tracks granular, execution-level tasks derived from the high-level [0.6.0-dev.md](file:///home/arturscheiner/CodePlace/Kaspersky/kcspoc/.roadmap/0.6.0-dev.md) roadmap.

---

## üèó MVC Architecture Refactor
- [x] E-001: Initialize directory structure: `/lib/model`, `/lib/view`, `/lib/control`
- [x] E-002: Refactor `kcspoc.sh` to implement automatic component discovery and sourcing
- [x] E-003: Migrate all UI/output logic (colors, icons, headers) to `/lib/view`
- [x] E-004: Migrate kubectl and filesystem wrappers to `/lib/model`
- [x] E-005: Establish standard "Controller" orchestration for existing commands
- [x] E-006: Implement component-based version hashing for robust versioning

## üé® Universal UI & Visual Identity (Revamp)
- [ ] E-007: Define standardized, high-contrast color palette in `base_view.sh` (Green/Red/Yellow/Orange)
- [ ] E-008: Implement `view_ui_table_header` and `view_ui_table_row` standardized helpers
- [ ] E-009: Audit and refactor `logs --list` and `pull --list-local` tables for structural consistency
- [ ] E-010: Audit and refactor all command headers to use `ORANGE` visual identity

## üõ° CNI Network Policy Enforcement Validation
- [ ] E-011: Create `lib/model/network_model.sh` for diagnostic pod and policy management
- [ ] E-012: Implement connectivity validation logic in `lib/service/check_service.sh`
- [ ] E-013: Integrate functional NetworkPolicy verification into `kcspoc check --deep`

## ü§ñ AI-Powered Capabilities (Ollama)
- [ ] E-014: Create `lib/service/ai_service.sh` for standardized Ollama interaction
- [ ] E-015: Implement `kcspoc logs --analyze <hash>` for AI-driven log interpretation
- [ ] E-016: Implement `kcspoc logs --report <hash>` for post-execution reporting
- [ ] E-017: Implement `kcspoc check --ai-eval` for diagnostic assistance
- [ ] E-018: Update configuration wizard to support specialized AI model selection

## üöÄ Workflows & Guided Execution
- [ ] E-019: Implement `--unattended` mode for `deploy` and `destroy` commands
- [ ] E-020: Orchestrate guided deployment walkthrough for new users (interactive hints)
- [ ] E-021: Improve post-execution summaries with actionable recommendations
- [x] E-022: Implement **S-018: Granular Component Management** in `kcspoc prepare` via `--install [comma-separated-list]`
    - [x] E-023: Extend `prepare_controller.sh` parser for `--install`
    - [x] E-024: Add component validation logic
    - [x] E-025: Implement selective execution in `prepare_service.sh`
- [x] E-026: Implement advanced lifecycle in `kcspoc prepare`
    - [x] E-027: Support `--install all` shortcut
    - [x] E-028: Implement `--uninstall [all|components]` flag and logic
    - [x] E-029: Update help UI and localization for new options

## üõ° Enhanced Configuration & Isolation
- [ ] E-030: Implement support for `KCSPOC_NAMESPACE` to isolate tool management
- [ ] E-031: Ensure sample vulnerable pods and test workloads are strictly isolated

## üõ† Stability & Resiliency (Core)
- [ ] E-032: Audit and refactor `execution_service.sh` traps to ensure signal propagation to subshells
- [ ] E-033: Implement signal-safe cleanup logic for `service_spinner` to prevent orphaned background frames
- [ ] E-034: Ensure all `kubectl` and `helm` wrappers handle termination signals gracefully

## üß© Extensible Component Architecture (Extras)
- [x] E-035: Implement `extras_controller` and basic CLI routing for the new command
- [x] E-036: Extract component lifecycle logic into a unified `extra_pack_service.sh`
- [x] E-037: Implement `model_remote_catalog` to fetch extra-pack definitions from the remote repository
- [x] E-038: Refactor `prepare_service` and `destroy_controller` to use the new `extra_pack_service`
- [x] E-039: Create the `extras` view for tabular display of the online catalog

## üõ†Ô∏è CLI Ergonomics & UX Improvements
- [x] E-040: Implement `-i`, `-u`, `-l` aliases for `kcspoc extras`
- [x] E-048: Remove `--install` and `--uninstall` logic from `prepare_controller.sh`
- [x] E-042: Implement `-v`, `-l` aliases for `kcspoc pull`
- [x] E-049: Update `prepare` help text to remove deprecated flags
- [x] E-043: Update help documentation for all command aliases
- **S-032**: AI-Integrated Multi-format Reporting Engine (HTML/MD/TXT) with Export capability.
- **S-033**: Template-driven AI Reporting Engine (Strict Content/Presentation Separation).

## üíæ State & Context Management
- [x] E-044: Implement `state_model.sh` for `~/.kcspoc/artifacts/installed-packs.json`
- [x] E-045: Integrate state recording into `service_extra_pack_install/uninstall`
- [x] E-046: Implement cluster context detection and metadata recording
- [x] E-047: Update `extras --list` view to indicate locally installed packs

## üìä Centralized Reporting Hub
- [x] E-054: Create `report_model.sh` for directory initialization and report indexing
- [x] E-055: Implement `reports_controller.sh` and matching View for listing and display
- [x] E-056: Implement `kcspoc reports --list` (filtering by hash, date, or command)
- [x] E-057: Update `check_controller.sh` to leverage the new report model when `--report` is used

## ‚öôÔ∏è Configuration Wizard UX
- [x] E-058: Analyze current config wizard flow and define logical grouping (Localization, Cluster, Product, Networking, Registry, Secrets, Diagnostics)
- [x] E-059: Refactor `_config_controller_wizard` in `config_controller.sh` to implement the new grouped order
- [x] E-060: Update step numbering and UI descriptions in `config_view.sh` to match the new logical sections
- [x] E-061: Verify that existing configurations are correctly loaded and preserved during the reordered wizard flow

## ü§ñ AI Capabilities Integration (Ollama)
- [x] E-062: Update `config_model.sh` to support `OLLAMA_ENDPOINT` and `OLLAMA_MODEL` persistence
- [x] E-063: Integrate AI configuration prompts (Endpoint, Default Model) into the config wizard
- [x] E-064: Implement `--ai-model` CLI flag in `base_controller.sh` and relevant sub-controllers
- [ ] E-065: Ensure AI service prioritizes CLI overrides over persistent configuration

## üõ† Configuration Verification Hub
- [x] E-066: Implement `--verify <component>` argument parsing in `config_controller.sh`
- [x] E-067: Implement `config_service_verify_ai` logic (connectivity and model availability)
- [x] E-068: Create `config_view_verify_action` for standardized reporting of verification results
- [x] E-069: Ensure Ollama verification logic is modular and reusable for future AI-powered commands

## üß™ KCS Labs Hub
- [ ] E-070: Implement `labs_controller.sh` for `--list` and `--run` argument orchestration
- [ ] E-071: Create `model_labs_catalog` to fetch and parse remote lab specifications
- [ ] E-072: Implement lab execution engine (playbook runner) with interactive user prompts
- [ ] E-073: Design `labs_view` for formatted playbook display and progress tracking
- [ ] E-074: Ensure lab isolation (dedicated namespaces and cleanup hooks)

## ü§ñ AI Log Reporting
- [x] E-075: Define standardized prompt template and Markdown schema for log analysis
- [x] E-076: Implement `ai_service_generate_log_report` logic for structured extraction
- [x] E-077: Update `logs_controller.sh` to orchestrate `--show <hash> --report`
- [x] E-078: Ensure integration with `report_model.sh` for persistence in `~/.kcspoc/reports/`

## ü§ñ AI-Integrated Readiness Audit (S-030)
- [x] E-079: Initialize `lib/model/ai/prompts/` for centralized prompt engineering
- [x] E-080: Implement internal fact-collection service (JSON) for the check reporting flow
- [x] E-081: Author official KCS "Readiness Checklist" prompt template
- [x] E-082: Implement AI logic to validate cluster facts against the checklist prompt
- [x] E-083: Update `check_controller.sh` to trigger the AI-driven audit only during the report generation phase

## üìä Multi-format Reporting & Export (S-032)
- [ ] E-084: Define unified AI schemas for HTML, MD, and TXT outputs (Ensuring data consistency)
- [ ] E-085: Update `check_controller.sh` to support `--format` coupled with AI execution
- [ ] E-086: Implement specialized AI prompt injection for format selection
- [ ] E-087: Implement `--save-as | -s` in `reports_controller.sh`
- [ ] E-088: Add `model_report_export()` to handle formal artifact relocation

## üèóÔ∏è Template-driven AI Reporting Engine (S-033)
- [ ] E-089: Define a final, strict JSON Schema for the "Readiness Audit Findings"
- [ ] E-090: Refactor `ai_service.sh` to enforce raw JSON responses from the AI Engine
- [ ] E-091: Implement the "Rendering Engine" (Template processor) in the View layer for HTML, MD, and TXT
- [ ] E-092: Update `readiness_checklist.md` into a "Pure logic" prompt (Findings only)

## üåê Report Serving Hub (S-034)
- [x] E-093: Implement `--serve` (alias `-p`) flag parsing in `reports_controller.sh`
- [x] E-094: Create `service_report_serve()` to orchestrate `index.html` generation and `http.server` startup
- [x] E-095: Implement high-fidelity `index.html` generator in the View layer
- [x] E-096: Update locale help text for `reports` command

## üöÄ Bootstrap Enhancements
- [x] E-097: Implement token detection logic in `BootstrapController`
- [x] E-098: Add `bootstrap_service_is_configured()` check to verify token validity
- [x] E-099: Update `BootstrapView` for "Token already configured" visual feedback
- [x] E-100: Create `KCS_API_Model` for multi-stage REST interactions
- [x] E-101: Implement Security Scope discovery service
- [x] E-102: Implement Agent Group provisioning logic with PoC defaults
- [x] E-103: Implement Asset Management for persistent storage of deployment YAMLs
- [x] E-104: Implement `kcspoc config --verify kcs` for API health checks
- [ ] E-105: Implement `kcspoc deploy --agents` using local assets
- [ ] E-106: Implement `kcspoc extras --uninstall all` to remove all packs in current context

## üè∑Ô∏è Extra-Packs Resource Labeling & State Accuracy

- [x] E-107: Add `kcspoc.io/managed-by=extras` label to all helm namespaces created by extra-pack installs (cert-manager, metallb-system, ingress-nginx, local-path-storage)
- [x] E-108: Add `kcspoc.io/managed-by=extras` label to non-helm resources (kcs-registry-secret, metrics-server deployment)
- [ ] E-109: Implement `model_state_is_actually_installed` in `state_model.sh` to reconcile state file against real cluster presence (calls `_service_extra_is_installed` per entry)
- [ ] E-110: Update `extras --list` view to show a reconciled status: distinguish "tracked+installed", "tracked+missing", and "untracked+present" states
- [ ] E-111: Verify `model_state_record_install` is idempotent (no duplicates on re-install) and `model_state_record_uninstall` is only called after confirmed cluster removal
